generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String    @id @default(uuid())
  email         String    @unique
  passwordHash  String    @map("password_hash")
  firstName     String?   @map("first_name")
  lastName      String?   @map("last_name")
  phone         String?
  profile       Json?
  preferences   Json?
  createdAt     DateTime  @default(now()) @map("created_at")
  updatedAt     DateTime  @updatedAt @map("updated_at")
  deletedAt     DateTime? @map("deleted_at")

  addresses      Address[]
  paymentMethods PaymentMethod[]
  refreshTokens  RefreshToken[]
  priceTracking  PriceTracking[]

  @@map("users")
}

model Address {
  id           String   @id @default(uuid())
  userId       String   @map("user_id")
  label        String?
  addressLine1 String   @map("address_line1")
  addressLine2 String?  @map("address_line2")
  city         String
  state        String
  postalCode   String   @map("postal_code")
  country      String   @default("US")
  isDefault    Boolean  @default(false) @map("is_default")
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("user_addresses")
}

model PaymentMethod {
  id           String   @id @default(uuid())
  userId       String   @map("user_id")
  provider     String
  token        String
  last4        String?
  cardBrand    String?  @map("card_brand")
  expiryMonth  Int?     @map("expiry_month")
  expiryYear   Int?     @map("expiry_year")
  isDefault    Boolean  @default(false) @map("is_default")
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("payment_methods")
}

model RefreshToken {
  id        String   @id @default(uuid())
  userId    String   @map("user_id")
  token     String   @unique
  expiresAt DateTime @map("expires_at")
  createdAt DateTime @default(now()) @map("created_at")

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([token])
  @@map("refresh_tokens")
}

model PriceTracking {
  id              String   @id @default(uuid())
  userId          String   @map("user_id")
  productId       String   @map("product_id")
  productName     String   @map("product_name")
  store           String
  initialPrice    Decimal  @map("initial_price")
  currentPrice    Decimal  @map("current_price")
  targetPrice     Decimal? @map("target_price")
  priceDropPercent Decimal? @default(10) @map("price_drop_percent")
  imageUrl        String?  @map("image_url")
  category        String?
  isActive        Boolean  @default(true) @map("is_active")
  notified        Boolean  @default(false)
  lastChecked     DateTime @default(now()) @map("last_checked")
  createdAt       DateTime @default(now()) @map("created_at")
  updatedAt       DateTime @updatedAt @map("updated_at")

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, productId, store])
  @@index([userId])
  @@index([productId])
  @@index([isActive])
  @@map("price_tracking")
}
